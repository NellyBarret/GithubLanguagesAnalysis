<!DOCTYPE HTML>
<html>
	<head>
	<meta charset="utf-8">
	<title>Github Languages Analysis</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://fonts.googleapis.com/css?family=Raleway:100,300,400,700" rel="stylesheet">
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">
	<!-- Theme style  -->
	<link rel="stylesheet" href="css/style.css">
	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- D3.js -->
	<script src="https://d3js.org/d3.v5.min.js"></script>
	</head>
	<body>
		
	<div class="loader"></div>
	
	<div id="page">

		<header id="header" class="cover" role="banner">
			<div class="container">
        
				<h1>Github Languages Analysis</h1>
				<!-- <div id="chordDiagDiv"></div> -->
				<img src="logo-github.png" height="150" style="margin-bottom: 5rem; display: block; margin-left: auto; margin-right: auto;">
				<div class="display-t">
					<div class="display-tc">
							<div class="text-center animate-box">
								<!-- <h1>Make your life simpler, try this for free.</h1> -->
								<p>Le service GitHub permet d'héberger et de gérer le développement de logiciels. Il a réussi à se faire un nom depuis son lancement en 2008. Aujourd'hui, GitHub compte 37 millions d'utilisateurs, plus de 100 millions de dépôts (dont 28 millions sont publics). Ainsi, se profile la problématique suivante :</p>
								<h2>Comment caractériser l'évolution des langages utilisés dans les projets déposés sur GitHub ?</h2>
								<p>Notre méthode propose une visualisation interactive de l'évolution de la popularité des langages utilisés sur GitHub.</p>
							</div>
					</div>
				</div>
			</div>
		</header>
		<!-- END #header -->

		<div class="services section">
			<div class="container">
				<div class="heading text-center">
					<h2>Make your life simpler.</h2>
					<!-- <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus placerat enim et urna sagittis, rhoncus euismod erat tincidunt. Donec tincidunt volutpat erat.</p> -->
					<div id="chordDiagDiv"></div>
				</div>
			</div>
		</div>

		<div class="services section">
			<div class="container">
				<div class="heading text-center">
					<h2>Récupération de données</h2>
					<p>Github propose une API REST à l'adresse suivante : <a href="https://api.github.com">https://api.github.com</a>. </p>
					<p>Positionnez votre souris sur un langage ou un lien pour plus de détails. Sélectionnez une année dans le slider pour mettre à jour le diagramme avec les données de l'année sélectionnée.</p>
				</div>
			</div>
		</div>
		<!-- END .services -->

	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="icon-arrow-up"></i></a>
	</div>
	
	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Carousel -->
	<script src="js/owl.carousel.min.js"></script>
	<!-- Main -->
	<script src="js/main.js"></script>

	</body>

	<script>
		rawData = {
		  "2019": 
			[
			  {
				"id": 0,
				"stars": 20,
				"forks": 5,
				"languages": ["js", "python", "bash"]
			  },
			  {
				"id": 1,
				"stars": 100,
				"forks": 20,
				"languages": ["java", "bash"]
			  },
			  {
				"id": 2,
				"stars": 3,
				"forks": 1,
				"languages": ["python", "bash"]
			  },
			  {
				"id": 3,
				"stars": 2000,
				"forks": 53,
				"languages": ["go", "c++"]
			  },
			  {
				"id": 4,
				"stars": 50,
				"forks": 7,
				"languages": ["java"]
			  }
			],
		  "2018": 
			[
			  {
				"id": 0,
				"stars": 20,
				"forks": 5,
				"languages": ["js", "bash"]
			  },
			  {
				"id": 1,
				"stars": 100,
				"forks": 20,
				"languages": ["java", "bash"]
			  },
			  {
				"id": 2,
				"stars": 3,
				"forks": 1,
				"languages": ["python", "bash"]
			  },
			  {
				"id": 3,
				"stars": 2000,
				"forks": 53,
				"languages": ["go", "c++", "scala"]
			  },
			  {
				"id": 4,
				"stars": 50,
				"forks": 7,
				"languages": ["java"]
			  },
			  {
				"id": 5,
				"stars": 50,
				"forks": 7,
				"languages": ["java", "scala", "c++"]
			  }
			],
		};
		
		addChordDiag(rawData);
		
		function addChordDiag(rawData) {
		  link_methods = {
			0: "raw",
			1: "symetric",
			2: "language_based"
		  }
		  link_method = 2;
		  
		  /////////////////
		  // Data Import //
		  /////////////////
		  
		  dataByYear = {};
		  metrics = [];
		  
		  // function for adding a new language to the data
		  function includeLanguage(data, lang) {
			if (!data.languages.includes(lang)) {
			  data.languageToIndex[lang] = data.languages.length;
			  for (metric in data.metrics) {
				data.metrics[metric].push(0);
			  }
			  data.languages.push(lang);
	  
			  for (arr of data.matrix) {
				arr.push(0);
			  }
			  data.matrix.push(Array(data.languages.length).fill(0));
			}
		  }
		  
		  for (year in rawData) {
			data =
			   {
				   "matrix": [],
				  "languages": [],
				  "languageToIndex": {},
				  "metrics": {
					"numberOfProjects": [],
					"stars": [],
					"forks": []
				  }
			   };
	  
			for (project of rawData[year]) { 
			  // initializing new languages
			  for (lang1 of project.languages) {
				includeLanguage(data, lang1);
				i = data.languageToIndex[lang1];
				
				// Updating metrics
				++data.metrics.numberOfProjects[i];
				data.metrics.stars[i] += project.stars;
				data.metrics.forks[i] += project.forks;
				
				// Updating matrix
				for (lang2 of project.languages) {
				  if (lang1 != lang2) {
					includeLanguage(data, lang2);
					j = data.languageToIndex[lang2];
					++data.matrix[i][j];
				  }
				}
			  }
			}
			
			////////////////////////
			// Data Preprocessing //
			////////////////////////
	  
			lm = link_methods[link_method];
			// normalizing the links
			for (i = 0; i < data.languages.length; ++i) {
			  for (j = 0; j < data.languages.length; ++j) {
				if (i != j) {
				  if (lm === "symetric") {
					min = Math.min(data.metrics.numberOfProjects[i], data.metrics.numberOfProjects[j]);
					data.matrix[i][j] /= min;
				  }
				  else if (lm === "language_based") {
					data.matrix[i][j] /= data.metrics.numberOfProjects[i];
				  }
				}
			  }
			}
		  
			// Loading metrics list
			if (year === Object.keys(rawData)[0]) {
			  metrics = Object.keys(data.metrics);
			}
			
			// Normalizing metrics
			var preprocess = d => Math.sqrt(d);
			
			for (metric in data.metrics) {
			  newMetric = data.metrics[metric].map(preprocess);
			  var max = Math.max(...newMetric);
			  newMetric = newMetric.map(e => e / max);
			  data.metrics[metric + "_normalized"] = newMetric;
			}
			
			dataByYear[year] = data;
		  }
		  
		  ////////////////
		  // Parameters //
		  ////////////////
		  
		  // size
		  width = 960;
		  height = 450;
		  
		  // diagram
		  outerRadius = Math.min(width, height) * 0.5;
		  innerRadius = outerRadius - 64;
		  minArcLength = 20;
		  maxArcLength = 60;
		  padAngle = .04;
		  color = d3.scaleOrdinal(d3.schemeCategory10);
		  fill_opacity = 0.67;
		  
		  // animation
		  background_opacity = 0.2;
		  transitionTime = 500;
	  
		  ///////////////
		  // Interface //
		  ///////////////
	  
		  years = Object.keys(dataByYear).map(y => parseInt(y));
		  minYear = d3.min(years);
		  maxYear = d3.max(years);
		  year = minYear;
		  metric = metrics[0];
	  
		  const ui = d3.select("#chordDiagDiv")
					  .append("div");
	  
		  ui.append("input")
			.attr("id", "yearSlider")
			.attr("type", "range")
			.attr("min", minYear)
			.attr("max", maxYear)
			.attr("value", minYear)
			.on("input", function() {
			  year = this.value;
			  d3.select("#yearSpan")
				.text(` year ${year}`);
			  draw(year, metric);
		  });
		  
		   ui.append("span")
			.attr("class", "ui")
			.attr("id", "yearSpan")
			.text(` year ${minYear}`);
		  
		  const parameters = ui.append("span");
		  const selectMetric = ui.append("select");
	  
		  selectMetric.selectAll("option")
			.data(metrics)
			.join("option")
			.attr("value", d => d)
			.text(d => d)
			.on("change", function() {
			  metric = this.value;
			  draw(year, metric);
		  })
	  
		  ////////////
		  // Events //
		  ////////////   
	  
		  var arc_mouseenter = function(d) {
			svg.selectAll("path").transition().duration(transitionTime)
				 .style("opacity", background_opacity);
			d3.select(this).transition()
				 .style("opacity", 1);
			svg.selectAll(".ribbon")
			   .filter(r => r.source.index === d.index || r.target.index === d.index)
			   .each(function (r) {
				  d3.select(`#arc_${r.source.index}`).transition()
					.style("opacity", 1);
				  d3.select(`#arc_${r.target.index}`).transition()
					.style("opacity", 1);
				})
			   .transition()
			   .style("opacity", 1);
		  }
	  
		  var arc_mouseleave = function(d) {
			svg.selectAll("path").transition().duration(transitionTime)
				 .style("opacity", 1);
		  }
	  
		  var ribbon_mouseenter = function(d) {
			svg.selectAll("path").transition().duration(transitionTime)
				 .style("opacity", background_opacity);
			d3.select(this).transition()
				 .style("opacity", 1);
			d3.select(`#arc_${d.source.index}`).transition()
				 .style("opacity", 1);
			d3.select(`#arc_${d.target.index}`).transition()
				 .style("opacity", 1);
		  }
	  
		  var ribbon_mouseleave = function(d) {
			svg.selectAll("path").transition().duration(transitionTime)
				 .style("opacity", 1);
		  }
	  
		  /////////////
		  // Drawing //
		  /////////////
	  
		  function draw(year, metric) {
			d3.select("#chordDiagram").remove();
	  
			svg = d3.select("#chordDiagDiv").append("svg")
			  .attr("id", "chordDiagram")
			  .attr("viewBox", [-width / 2, -height / 2, width, height])
			  .attr("font-size", 10)
			  .attr("font-family", "sans-serif")
			  .style("width", "100%")
			  .style("height", "auto");
	  
			ribbon = d3.ribbon()
			  .radius(innerRadius);
			arc = d3.arc()
			  .innerRadius(innerRadius)
			  .outerRadius(d => innerRadius + minArcLength + dataByYear[year].metrics[metric + "_normalized"][d.index] * (maxArcLength - minArcLength));
			chord = d3.chord()
			  .padAngle(padAngle)
			  .sortSubgroups(d3.descending)
			  .sortChords(d3.descending)
	  
			chords = chord(dataByYear[year].matrix);
	  
			group = svg.append("g")
			  .attr("id", "arcs")
			  .selectAll("g")
			  .data(chords.groups)
			  .join("g");
	  
			group.append("path")
				.attr("id", d => `arc_${d.index}`)
				.attr("fill", d => color(d.index))
				.attr("stroke", d => color(d.index))
				.attr("d", arc)
				.on("mouseenter", arc_mouseenter)
				.on("mouseleave", arc_mouseleave);
	  
			group.append("text")
				.each(d => { d.angle = (d.startAngle + d.endAngle) / 2; })
				.attr("dy", ".35em")
				.attr("transform", d => `
				  rotate(${(d.angle * 180 / Math.PI - 90)})
				  translate(${innerRadius + 26})
				  ${d.angle > Math.PI ? "rotate(180)" : ""}
				`)
				.attr("text-anchor", d => d.angle > Math.PI ? "end" : null)
				.text(d => dataByYear[year].languages[d.index]);
	  
			svg.append("g")
			  .attr("id", "ribbons")
			  .attr("fill-opacity", fill_opacity)
			  .selectAll("path")
			  .data(chords)
			  .join("path")
				.attr("class", "ribbon")
				.attr("id", d => `ribbon_${d.source.index}_${d.target.index}`)
				.attr("stroke", d => d3.rgb(color(d.source.index)).darker())
				.attr("fill", d => color(d.source.index))
				.attr("d", ribbon)
				.on("mouseenter", ribbon_mouseenter)
				.on("mouseleave", ribbon_mouseleave);
		  }
	  
		  draw(year, metric);
		}
	  </script>
</html>

